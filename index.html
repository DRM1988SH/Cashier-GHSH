<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>نظام إدارة المسلخ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
  <style>
    body {
      background: #f8f9fa;
    }

    .screen {
      display: none;
    }

    .active {
      display: block !important;
    }

    label {
      font-weight: bold;
    }

    .btn-back {
      margin-top: 15px;
    }

    .sticker {
      border: 1px solid #000;
      padding: 10px;
      width: 350px;
      background: #fff;
      margin: 10px auto;
      font-weight: bold;
      font-size: 1.1em;
      text-align: center;
    }
  </style>
</head>

<body>

  <!-- شاشة الترحيب -->
  <div class="container screen active" id="welcomeScreen">
    <div class="text-center mt-5">
      <img src="https://via.placeholder.com/800x300.png?text=مسلخ+مع+لحم+خروف+وطبيب+بيطري" alt="صورة ترحيب"
        class="img-fluid rounded" />
      <h3 class="mt-3">مرحبًا بكم في نظام إدارة المسالخ</h3>
      <button class="btn btn-primary mt-3" onclick="goToScreen('loginScreen')">ابدأ</button>
    </div>
  </div>

  <!-- شاشة تسجيل الدخول -->
  <div class="container screen" id="loginScreen">
    <div class="row justify-content-center mt-5">
      <div class="col-md-6">
        <div class="card p-4">
          <h4 class="text-center mb-4">تسجيل الدخول</h4>
          <label for="empID">الرقم الوظيفي</label>
          <input type="text" id="empID" class="form-control mb-2" placeholder="أدخل الرقم الوظيفي" />
          <div id="loginError" class="text-danger mb-3" style="display:none;">رقم وظيفي غير صحيح!</div>
          <div class="text-center">
            <button class="btn btn-success" onclick="login()">دخول</button>
          </div>
          <button class="btn btn-outline-dark btn-back w-100 mt-3" onclick="goToScreen('welcomeScreen')">رجوع</button>
        </div>
      </div>
    </div>
  </div>

  <!-- شاشة لوحة التحكم -->
  <div class="container screen" id="dashboard">
    <h3 class="mt-4 text-center">لوحة التحكم</h3>
    <div class="row g-3 mt-4">
      <div class="col-md-4">
        <button class="btn btn-primary w-100" onclick="goToScreen('userSettings')">إعدادات المستخدم</button>
      </div>
      <div class="col-md-4">
        <button class="btn btn-secondary w-100" onclick="goToScreen('entryScreen')">الإدخال</button>
      </div>
      <div class="col-md-4">
        <button class="btn btn-dark w-100" onclick="goToScreen('clientsReportScreen')">تقرير المتعاملين</button>
      </div>
      <div class="col-md-4">
        <button class="btn btn-warning w-100" onclick="goToScreen('invoicesScreen')">الفواتير</button>
      </div>
      <div class="col-md-4">
        <button class="btn btn-success w-100" onclick="goToScreen('statisticsScreen')">التقرير الإحصائي</button>
      </div>
      <div class="col-md-4">
        <button class="btn btn-danger w-100" onclick="goToScreen('stickerScreen')">طباعة الاستيكر</button>
      </div>
    </div>
    <button class="btn btn-outline-dark btn-back mt-4" onclick="logout()">تسجيل خروج</button>
  </div>

  <!-- شاشة إعدادات المستخدم -->
  <div class="container screen" id="userSettings">
    <h4 class="mt-4 text-center">إعدادات المستخدم</h4>

    <form id="userForm" class="row g-3" onsubmit="addUser(event)">
      <div class="col-md-3">
        <label for="userName">اسم المستخدم</label>
        <input type="text" id="userName" class="form-control" required />
      </div>
      <div class="col-md-3">
        <label for="userID">الرقم الوظيفي</label>
        <input type="text" id="userID" class="form-control" required />
      </div>
      <div class="col-md-3">
        <label for="userRole">الصلاحية</label>
        <select id="userRole" class="form-select" required>
          <option value="">اختر الصلاحية</option>
          <option value="مدخل بيانات">مدخل بيانات</option>
          <option value="مشرف">مشرف</option>
        </select>
      </div>
      <div class="col-md-3 d-flex align-items-end">
        <button type="submit" class="btn btn-success w-100">إضافة مستخدم</button>
      </div>
    </form>

    <h5 class="mt-4">إعدادات الذبائح وأنواع التقطيع</h5>

    <form id="animalCutForm" class="row g-3" onsubmit="addAnimalCut(event)">
      <div class="col-md-4">
        <label for="animalType">نوع الذبيحة</label>
        <input list="animalTypesList" id="animalType" class="form-control" placeholder="أدخل نوع الذبيحة" required />
        <datalist id="animalTypesList">
          <option value="خروف"></option>
          <option value="ماعز"></option>
          <option value="عجل صغير"></option>
          <option value="بقر"></option>
          <option value="حوار صغير"></option>
          <option value="جمل كبير"></option>
        </datalist>
      </div>
      <div class="col-md-4">
        <label for="cutType">نوع التقطيع</label>
        <input list="cutTypesList" id="cutType" class="form-control" placeholder="أدخل نوع التقطيع" required />
        <datalist id="cutTypesList"></datalist>
      </div>
      <div class="col-md-2">
        <label for="animalPrice">سعر الذبيحة</label>
        <input type="number" id="animalPrice" class="form-control" min="0" required />
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <button type="submit" class="btn btn-info w-100">إضافة نوع ذبيحة</button>
      </div>
    </form>

    <table class="table table-bordered mt-4" id="usersTable">
      <thead>
        <tr>
          <th>اسم المستخدم</th>
          <th>الرقم الوظيفي</th>
          <th>الصلاحية</th>
          <th>إجراءات</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <table class="table table-bordered mt-4" id="animalCutsTable">
      <thead>
        <tr>
          <th>نوع الذبيحة</th>
          <th>نوع التقطيع</th>
          <th>السعر</th>
          <th>إجراءات</th>
        </tr>
      </thead>
      <<tbody></tbody>
    </table>

    <button class="btn btn-outline-dark btn-back" onclick="goToScreen('dashboard')">رجوع</button>
  </div>

  <!-- شاشة الإدخال -->
  <!-- شاشة الإدخال -->
<div class="container screen" id="entryScreen">
  <h4 class="mt-4 text-center fw-bold">مسلخ مدينة غياثي</h4>

  <form id="entryForm" class="mb-4" onsubmit="addEntry(event)">
    <!-- سطر التاريخ -->
    <div class="row mb-3 justify-content-start">
      <div class="col-md-3 text-end">
        <label for="entryDate" class="form-label"><i class="bi bi-calendar3"></i> التاريخ</label>
        <input type="date" id="entryDate" class="form-control" required />
      </div>
    </div>

    <!-- سطر: رقم الهاتف - اسم المتعامل -->
    <div class="row mb-3">
      <div class="col-md-4">
        <label for="clientPhone" class="form-label"><i class="bi bi-telephone"></i> رقم الهاتف</label>
        <input type="tel" id="clientPhone" class="form-control" required pattern="[0-9]{9,12}" />
      </div>

      <div class="col-md-4">
        <label for="clientName" class="form-label"><i class="bi bi-person"></i> اسم المتعامل</label>
        <input type="text" id="clientName" class="form-control" required />
      </div>
    </div>

    <!-- سطر: رقم الفاتورة - الذبيحة - الاستيكر -->
    <div class="row mb-4 g-3">
      <div class="col-md-4">
        <label for="invoiceNumber" class="form-label"><i class="bi bi-receipt"></i> رقم الفاتورة</label>
        <input type="text" id="invoiceNumber" class="form-control" readonly />
      </div>
      <div class="col-md-4">
        <label for="slaughterID" class="form-label"><i class="bi bi-hammer"></i> رقم الذبيحة</label>
        <select id="slaughterID" class="form-select" required></select>
      </div>
      <div class="col-md-4">
        <label for="stickerID" class="form-label"><i class="bi bi-printer"></i> رقم الاستيكر</label>
        <select id="stickerID" class="form-select" required></select>
      </div>
    </div>

    <!-- سطر: النوع - التقطيع - العدد - السعر - الإجمالي -->
    <div class="row mb-4 g-3">
      <div class="col-md-3">
        <label for="animalTypeEntry" class="form-label"><i class="bi bi-paw"></i> نوع الذبيحة</label>
        <select id="animalTypeEntry" class="form-select" required></select>
      </div>
      <div class="col-md-3">
        <label for="cutTypeEntry" class="form-label"><i class="bi bi-scissors"></i> نوع التقطيع</label>
        <select id="cutTypeEntry" class="form-select" required></select>
      </div>
      <div class="col-md-2">
        <label for="quantity" class="form-label"><i class="bi bi-calculator"></i> العدد</label>
        <input type="number" id="quantity" class="form-control" min="1" value="1" required />
      </div>
      <div class="col-md-2">
        <label for="unitPriceEntry" class="form-label"><i class="bi bi-currency-dollar"></i> السعر</label>
        <input type="number" id="unitPriceEntry" class="form-control" readonly />
      </div>
      <div class="col-md-2">
        <label for="totalPriceEntry" class="form-label"><i class="bi bi-wallet2"></i> الإجمالي</label>
        <input type="number" id="totalPriceEntry" class="form-control" readonly />
      </div>
    </div>

    <!-- سطر: الملحقات - الدفع -->
    <div class="row g-3 mb-4">
      <div class="col-md-6">
        <label class="form-label"><i class="bi bi-box-seam"></i> ملحقات</label>
        <div>
          <input type="checkbox" id="addon1" value="كرش" />
          <label for="addon1" class="me-3">كرش</label>
          <input type="checkbox" id="addon2" value="مصران" />
          <label for="addon2" class="me-3">مصران</label>
          <input type="checkbox" id="addon3" value="كوارع" />
          <label for="addon3">كوارع</label>
        </div>
      </div>

      <div class="col-md-6">
        <label class="form-label"><i class="bi bi-credit-card-2-front"></i> طريقة الدفع</label>
        <div>
          <input type="radio" id="paymentCash" name="paymentMethod" value="كاش" checked />
          <label for="paymentCash" class="me-3">كاش</label>
          <input type="radio" id="paymentCard" name="paymentMethod" value="بطاقة" />
          <label for="paymentCard">بطاقة</label>
        </div>
      </div>
    </div>
    <!-- أزرار -->
    <div class="text-center mt-4">
      <button type="submit" class="btn btn-primary">إضافة وترحيل</button>
      <button type="button" class="btn btn-info ms-2" onclick="goToScreen('clientsReportScreen')">تقرير المتعاملين</button>
      <button type="button" class="btn btn-success ms-2" onclick="printSticker()">طباعة الاستيكر</button>
      <button type="button" class="btn btn-warning ms-2" onclick="printInvoice()">طباعة الفاتورة</button>
    </div>
  </form>
  <button class="btn btn-outline-dark btn-back mt-3" onclick="goToScreen('dashboard')">رجوع</button>
</div>

<!-- رابط أيقونات Bootstrap -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

  <!-- شاشة تقرير المتعاملين -->
  <div class="container screen" id="clientsReportScreen">
    <h4 class="mt-4 text-center">تقرير المتعاملين</h4>

    <div class="row g-3 mb-3">
      <div class="col-md-4">
        <label for="filterDateFrom">من تاريخ</label>
        <input type="date" id="filterDateFrom" class="form-control" />
      </div>
      <div class="col-md-4">
        <label for="filterDateTo">إلى تاريخ</label>
        <input type="date" id="filterDateTo" class="form-control" />
      </div>
      <div class="col-md-4 d-flex align-items-end">
        <button class="btn btn-primary w-100" onclick="filterClientsReport()">تصفية التقرير</button>
      </div>
    </div>

    <table class="table table-bordered" id="clientsReportTable">
      <thead>
        <tr>
          <th>تاريخ</th>
          <th>اسم المتعامل</th>
          <th>رقم الهاتف</th>
          <th>عدد الذبائح</th>
          <th>الإجمالي</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button class="btn btn-outline-dark btn-back mt-3" onclick="goToScreen('dashboard')">رجوع</button>
  </div>

  <!-- شاشة الفواتير -->
  <div class="container screen" id="invoicesScreen">
    <h4 class="mt-4 text-center">الفواتير</h4>

    <div class="row g-3 mb-3">
      <div class="col-md-4">
        <label for="invoiceDateFrom">من تاريخ</label>
        <input type="date" id="invoiceDateFrom" class="form-control" />
      </div>
      <div class="col-md-4">
        <label for="invoiceDateTo">إلى تاريخ</label>
        <input type="date" id="invoiceDateTo" class="form-control" />
      </div>
      <div class="col-md-4 d-flex align-items-end">
        <button class="btn btn-primary w-100" onclick="filterInvoices()">تصفية الفواتير</button>
      </div>
    </div>

    <table class="table table-bordered" id="invoicesTable">
      <thead>
        <tr>
          <th>رقم الفاتورة</th>
          <th>التاريخ</th>
          <th>اسم المتعامل</th>
          <th>الإجمالي</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button class="btn btn-outline-dark btn-back mt-3" onclick="goToScreen('dashboard')">رجوع</button>
  </div>

  <!-- شاشة التقرير الإحصائي -->
  <div class="container screen" id="statisticsScreen">
    <h4 class="mt-4 text-center">التقرير الإحصائي</h4>

    <div class="row g-3 mb-3">
      <div class="col-md-4">
        <label for="statsDateFrom">من تاريخ</label>
        <input type="date" id="statsDateFrom" class="form-control" />
      </div>
      <div class="col-md-4">
        <label for="statsDateTo">إلى تاريخ</label>
        <input type="date" id="statsDateTo" class="form-control" />
      </div>
      <div class="col-md-4 d-flex align-items-end">
        <button class="btn btn-primary w-100" onclick="filterStatistics()">تصفية التقرير</button>
      </div>
    </div>

    <div id="statsResult" class="mt-4"></div>

    <button class="btn btn-outline-dark btn-back mt-3" onclick="goToScreen('dashboard')">رجوع</button>
  </div>

  <!-- شاشة طباعة الاستيكر -->
  <div class="container screen" id="stickerScreen">
    <h4 class="mt-4 text-center">طباعة الاستيكر</h4>
    <div id="stickerPrintArea" class="sticker"></div>
    <button class="btn btn-primary mt-3" onclick="printSticker()">طباعة</button>
    <button class="btn btn-outline-dark btn-back mt-3" onclick="goToScreen('dashboard')">رجوع</button>
  </div>
<script>
  let invoiceCounter = 1;

  document.addEventListener("DOMContentLoaded", () => {
    // تعيين تاريخ اليوم تلقائيًا
    const today = new Date().toISOString().split("T")[0];
    document.getElementById("entryDate").value = today;

    // تعبئة أنواع الذبائح
    const animalTypes = ["خروف", "ماعز", "بقر", "إبل"];
    const animalTypeSelect = document.getElementById("animalTypeEntry");
    animalTypes.forEach(type => {
      const option = document.createElement("option");
      option.value = type;
      option.textContent = type;
      animalTypeSelect.appendChild(option);
    });

    // تعبئة أنواع التقطيع
    const cutTypes = ["كامل", "نصفين", "أرباع", "مفروم"];
    const cutTypeSelect = document.getElementById("cutTypeEntry");
    cutTypes.forEach(cut => {
      const option = document.createElement("option");
      option.value = cut;
      option.textContent = cut;
      cutTypeSelect.appendChild(option);
    });

    // تعبئة رقم الفاتورة تلقائيًا
    generateInvoiceNumber();

    // حساب الإجمالي تلقائيًا
    document.getElementById("quantity").addEventListener("input", calculateTotal);
    document.getElementById("unitPriceEntry").addEventListener("input", calculateTotal);

    // سعر ثابت (قابل للتعديل لاحقًا حسب نوع التقطيع)
    document.getElementById("cutTypeEntry").addEventListener("change", () => {
      const type = document.getElementById("cutTypeEntry").value;
      let price = 50;
      if (type === "نصفين") price = 60;
      else if (type === "أرباع") price = 70;
      else if (type === "مفروم") price = 80;
      document.getElementById("unitPriceEntry").value = price;
      calculateTotal();
    });
  });

  function generateInvoiceNumber() {
    const invoiceField = document.getElementById("invoiceNumber");
    invoiceField.value = "INV-" + String(invoiceCounter).padStart(4, "0");
    invoiceCounter++;
  }

  function calculateTotal() {
    const quantity = parseInt(document.getElementById("quantity").value) || 0;
    const unitPrice = parseFloat(document.getElementById("unitPriceEntry").value) || 0;
    document.getElementById("totalPriceEntry").value = quantity * unitPrice;
  }

  function goToScreen(screenId) {
    document.querySelectorAll(".screen").forEach(screen => {
      screen.classList.remove("active");
    });
    const target = document.getElementById(screenId);
    if (target) {
      target.classList.add("active");
    }
  }

  function addEntry(event) {
    event.preventDefault();
    // طباعة البيانات في الكونسول (يمكن تعديلها لاحقًا لإرسالها إلى سيرفر)
    const clientName = document.getElementById("clientName").value;
    const phone = document.getElementById("clientPhone").value;
    const date = document.getElementById("entryDate").value;
    const invoice = document.getElementById("invoiceNumber").value;
    const quantity = document.getElementById("quantity").value;
    const total = document.getElementById("totalPriceEntry").value;

    console.log(`تمت إضافة الفاتورة:
      المتعامل: ${clientName}
      الهاتف: ${phone}
      التاريخ: ${date}
      الفاتورة: ${invoice}
      العدد: ${quantity}
      الإجمالي: ${total}
    `);

    alert("تمت الإضافة بنجاح!");

    // إنشاء فاتورة جديدة
    generateInvoiceNumber();
    document.getElementById("entryForm").reset();
    document.getElementById("entryDate").value = new Date().toISOString().split("T")[0];
  }
</script>
</body>

</html>
